---
services:
  duplicati:
    image: duplicati/duplicati:2.1.2.3
    container_name: duplicati
    environment:
      - PUID=99
      - PGID=100
      - TZ=Europe/Berlin
      - SETTINGS_ENCRYPTION_KEY=${SETTINGS_ENCRYPTION_KEY}
      - DUPLICATI__WEBSERVICE_PASSWORD=${WEBSERVICE_PASSWORD}
    volumes:
      - duplicati.config:/config
      - /mnt/user/data:/source
    networks:
      - proxy
    ports:
      - 8200:8200
    restart: unless-stopped
    labels:
      # Traefik
      - "traefik.enable=true"
      - "kop.bind.ip=srv-unraid.local.darksaber.fyi"
      - "traefik.http.services.duplicati.loadbalancer.server.port=8200"
      - "traefik.http.routers.duplicati.rule=Host(`duplicati.darksaber.fyi`)"
      - "traefik.http.routers.duplicati.entrypoints=https"
      - "traefik.http.routers.duplicati.tls=true"
      - "traefik.http.routers.duplicati.middlewares=default-acl@docker"
      - "traefik.docker.network=proxy"

networks:
  proxy:
    external: true

volumes:
  duplicati.config: